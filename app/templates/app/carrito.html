<div class="cart-section">
    <h2>Tu carrito ({{ carrito_total_cantidad }} items)</h2>
    {% if carrito_items %}
    {% for item in carrito_items %}
    <div class="cart-item">
        <span class="product-name">{{ item.producto.nombre }}</span>
        <div class="cart-controls">
            <form method="post" action="{% url 'restar_producto' item.producto.producto_id %}" class="form-restar">
                {% csrf_token %}
                <button type="submit">-</button>
            </form>
            <input type="number" value="{{ item.cantidad }}" readonly>
            <form method="post" action="{% url 'agregar_al_carrito' item.producto.producto_id %}" class="form-agregar">
                {% csrf_token %}
                <button type="submit">+</button>
            </form>
        </div>
        <div class="product-price">{{ item.total_precio|floatformat:2 }} CLP</div>
        <form method="post" action="{% url 'eliminar_del_carrito' item.id %}" class="form-eliminar">
            {% csrf_token %}
            <button type="submit" class="remove-item">x</button>
        </form>
    </div>
    {% endfor %}
    <div class="summary">
        <span>Total productos: {{ carrito_total_cantidad }}</span>
        <span>Total: {{ carrito_total|floatformat:2 }} CLP</span>
    </div>
    <button type="button" class="confirm-btn" data-bs-toggle="modal" data-bs-target="#modalPago">Pagar</button>
    {% else %}
        <p>{{ mensaje_carrito_vacio }}</p>
    {% endif %}
</div>


<!-- Modal de pago -->
<div class="modal fade" id="modalPago" tabindex="-1" aria-labelledby="modalPagoLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalPagoLabel">Continuar con el pago</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>¿Cómo quieres proceder?</p>

                <!-- Div principal para los botones -->
                <div class="d-grid gap-3">

                    <!-- Botón para abrir el modal de registro de cliente -->
                    <button type="button" class="btn btn-success" data-bs-toggle="modal"
                        data-bs-target="#modalRegistrarCliente">
                        Registrar Cliente
                    </button>


                    <!-- Opción de Buscar Cliente Existente -->
                    <form method="post" action="">
                        <!-- {% csrf_token %} -->
                        <div class="input-group mb-3">
                            <input type="text" name="cliente_busqueda" class="form-control"
                                placeholder="Buscar cliente (nombre/correo)" required>
                            <button type="submit" class="btn btn-primary">Buscar cliente</button>
                        </div>
                    </form>

                    <!-- Opción de Continuar como Invitado -->
                    <form method="post" action="{% url 'confirmar_compra_invitado' %}">
                        {% csrf_token %}
                        <div class="input-group mb-3">
                            <input type="email" name="email_invitado" class="form-control" placeholder="Correo invitado"
                                required>
                            <button type="submit" class="btn btn-secondary">Continuar como Invitado</button>
                        </div>
                    </form>


                    <!-- Nueva opción para continuar sin agregar cliente -->
                    <form method="post" action="{% url 'confirmar_compra' %}">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-outline-dark w-100">Continuar sin agregar datos</button>
                    </form>

                </div> <!-- Fin del grid -->
            </div>
        </div>
    </div>
</div>