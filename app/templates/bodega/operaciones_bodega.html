{% extends 'app/base.html' %}

{% block contenido %}
<div class="container mt-4">
    <h1>Operaciones de Bodega</h1>

    <!-- Dropdown para seleccionar negocio (solo visible para administradores) -->
    {% if request.user.is_superuser %}
    <div class="mb-4">
        <form method="get" class="d-flex align-items-center">
            <label for="negocio" class="me-2">Cambiar de negocio:</label>
            <select name="negocio" id="negocio" class="form-select w-auto me-3" onchange="this.form.submit();">
                <option value="">Todos</option>
                {% for negocio in negocios %}
                <option value="{{ negocio.id }}" {% if negocio_filtro == negocio.id %}selected{% endif %}>
                    {{ negocio.nombre }}
                </option>
                {% endfor %}
            </select>
        </form>
    </div>
    {% endif %}
    

    <!-- Formulario de registro de entrada de productos (visible solo para staff) -->
    {% if not request.user.is_superuser %}
    <h2>Registrar Entrada de Productos</h2>
    <form method="post">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit" class="btn btn-primary">Registrar Entrada</button>
    </form>
    {% endif %}

<!-- Tabla de productos recibidos -->
<h2 class="mt-5">Productos Recibidos</h2>
<table class="table table-bordered table-hover">
    <thead class="table-dark">
        <tr>
            <th>Producto</th>
            <th>Cantidad Recibida</th>
            <th>Proveedor</th>
            <th>Lote</th>
            <th>Precio Unitario</th>
            <th>Precio Total</th> <!-- Nueva columna para el precio total -->
            <th>Fecha de Entrada</th>
        </tr>
    </thead>
    <tbody>
        {% for entrada in entradas %}
        <tr>
            <td>{{ entrada.producto.nombre }}</td>
            <td>{{ entrada.cantidad_recibida }}</td>
            <td>{{ entrada.proveedor.nombre }}</td>
            <td>{{ entrada.lote }}</td>
            <td>${{ entrada.precio_unitario }}</td>
            <td>${{ entrada.total_entrada }}</td> <!-- Mostrar el precio total calculado -->
            <td>{{ entrada.fecha_entrada }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>


    <!-- Sección: Registro de Productos Devueltos -->
    <h2 class="mt-5">Registro de Productos Devueltos</h2>
    <table class="table table-bordered table-hover">
        <thead class="table-dark">
            <tr>
                <th>Producto</th>
                <th>Cantidad Devuelta</th>
                <th>Proveedor</th>
                <th>Lote</th>
                <th>Precio Unitario</th>
                <th>Motivo de Devolución</th>
                <th>Fecha de Devolución</th>
            </tr>
        </thead>
        <tbody>
            {% if devoluciones %}
            {% for devolucion in devoluciones %}
            <tr>
                <td>{{ devolucion.producto.nombre }}</td>
                <td>{{ devolucion.cantidad_devuelta }}</td>
                <td>{{ devolucion.proveedor.nombre }}</td>
                <td>{{ devolucion.lote }}</td>
                <td>${{ devolucion.entrada_bodega.precio_unitario }}</td>
                <td>{{ devolucion.motivo_devolucion }}</td>
                <td>{{ devolucion.fecha_devolucion }}</td>
            </tr>
            {% endfor %}
            {% else %}
            <tr>
                <td colspan="7" class="text-center">No hay productos devueltos registrados.</td>
            </tr>
            {% endif %}
        </tbody>
    </table>
</div>
{% endblock %}
